<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:replace="_fragments/layout :: layout(~{::section}, '상품 상세')">
<section th:fragment="content" th:object="${product}">
  <h1 th:text="*{name}">상품 상세</h1>

  <div>
    <img th:src="*{image}" alt="cover" width="240" height="336"/>
  </div>

  <dl>
    <dt>가격</dt><dd th:text="${#numbers.formatInteger(product.price, 3, 'COMMA')}">0</dd>
    <dt>재고</dt><dd th:text="*{stock}">0</dd>
    <dt>책 크기</dt><dd th:text="*{size}">-</dd>
    <dt>평점</dt><dd th:text="*{rating}">0</dd>
    <dt>판매지수</dt><dd th:text="*{saleIndex}">0</dd>
  </dl>

  <div>
    <form th:action="@{|/cart|}" method="post">
      <input type="hidden" name="productId" th:value="*{id}" />
      <input type="number" name="qty" min="1" value="1" />
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit">장바구니 담기</button>
    </form>

    <form th:action="@{/checkout}" method="post">
      <input type="hidden" name="productId" th:value="*{id}" />
      <input type="hidden" name="qty" value="1" />
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit">바로구매</button>
    </form>
  </div>

  <article>
    <h2>상세설명</h2>
    <div th:utext="*{description}"></div>
  </article>

  <section>
    <h2>리뷰</h2>
    <ul>
      <li th:each="r : ${reviews}">
        <strong th:text="${r.author}">작성자</strong>
        <p th:text="${r.text}">리뷰 내용</p>
      </li>
    </ul>

    <form th:action="@{|/products/${product.id}/reviews|}" method="post">
      <textarea name="text" rows="3" placeholder="리뷰를 남겨주세요"></textarea>
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
      <button type="submit">등록</button>
    </form>
  </section>
</section>
</html>
