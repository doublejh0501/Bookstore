<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>
<header th:fragment="site-header" style="font-family: 'Noto Sans KR', Arial, sans-serif;">
  <style>
    html, body { margin:0; padding:0; background:#fff; overflow-x:hidden; }

    .global-header{
      position:sticky; top:0; z-index:999; width:100%;
      background:#fff; box-shadow:0 6px 20px rgba(10,30,70,.08);
    }
    .header-top{
      display:flex; align-items:center; justify-content:space-between;
      max-width:1200px; margin:0 auto; padding:18px 24px; gap:40px;
    }
    .header-logo a{ font-size:28px; font-weight:800; color:#0046ff; text-decoration:none; }

    .header-search{ flex:1; display:flex; justify-content:center; }
    .header-search form{
      display:flex; align-items:center; width:100%; max-width:560px; height:48px;
      background:#fff; border:1px solid #d5d5d5; border-radius:24px; padding-right:8px;
      box-sizing:border-box; transition:border-color .2s ease;
      position:relative;
    }
    .header-search form:focus-within{ border-color:#111; }
    .custom-select{ position:relative; flex:0 0 116px; height:100%; margin:0; }
    .custom-select::after{
      content:""; position:absolute; top:50%; right:0; width:1px; height:16px;
      background:#eaeaea; transform:translateY(-50%);
    }
    .custom-select__trigger{
      display:flex; align-items:center; justify-content:flex-start;
      position:relative; width:100%; height:100%; padding:0 34px 0 24px;
      background:none; border:none; color:#111; font-size:14px; font-weight:500;
      cursor:pointer;
    }
    .custom-select__trigger:focus-visible{
      outline:2px solid #0055ff; outline-offset:2px; border-radius:22px;
    }
    .custom-select__caret{
      position:absolute; right:16px; top:50%; width:0; height:0;
      border-left:4px solid transparent; border-right:4px solid transparent;
      border-top:5px solid #111; transform:translateY(-50%);
      transition:transform .15s ease; pointer-events:none;
    }
    .custom-select.is-open .custom-select__caret{ transform:translateY(-50%) rotate(180deg); }
    .custom-select__menu{
      list-style : none;
      display:none; position:absolute; top:calc(100% + 1px); left:0; width:180px;
      background:#fff; border:1px solid #d5d5d5; border-radius:16px; padding:8px 0;
      box-shadow:0 24px 48px rgba(15,30,65,.12); z-index:2000;
    }
    .custom-select.is-open .custom-select__menu{ display:block; }
    .custom-select__option{
      padding:10px 20px; font-size:14px; font-weight:500; color:#333; cursor:pointer;
    }
    .custom-select__option:hover{ background:#f3f5f9; }
    .custom-select__option.is-active{ color:#0070f3; font-weight:600; }

    .header-search input[type="search"]{
      flex:1; min-width:0; border:none; background:transparent; height:100%;
      padding:0 16px; font-size:14px; color:#111;
    }
    .header-search input[type="search"]::placeholder{ color:#767676; }
    .header-search input[type="search"]:focus{ outline:none; }
    .header-search__submit{
      display:flex; align-items:center; justify-content:center;
      width:40px; height:40px; margin-left:4px;
      border:none; background:transparent; border-radius:20px;
      cursor:pointer; transition:background-color .2s ease;
    }
    .header-search__submit:hover,
    .header-search__submit:focus-visible{
      background-color:#f3f5f9; outline:none;
    }
    .header-search__submit svg{ width:22px; height:22px; fill:#111; }
    .visually-hidden{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* 카테고리 바(그대로) */
    .header-category{ width:100%; background:#fff; border-top:1px solid rgba(0,70,255,.08); border-bottom:1px solid rgba(0,70,255,.08); }
    .header-category ul{ max-width:1200px; margin:0 auto; padding:0 24px; display:flex; align-items:center; gap:28px; list-style:none; }
    .header-category a{ display:inline-block; padding:14px 0; font-size:15px; font-weight:600; color:#334155; text-decoration:none; }
    .header-category a:hover{ color:#0046ff; }

    .header-links{ display:flex; gap:18px; align-items:center; }
    .header-links a{ text-decoration:none; color:#1f2d3d; font-weight:600; font-size:15px; }
    .header-links a:hover{ color:#0046ff; }
  </style>

  <div class="global-header">
    <div class="header-top">
      <div class="header-logo"><a th:href="@{/}">BookStore</a></div>

      <div class="header-search">
        <form th:action="@{/books}" method="get">
          <!-- 🔽 커스텀 드롭다운 -->
          <div class="custom-select" id="fieldSelect">
            <button type="button" class="custom-select__trigger" aria-haspopup="listbox" aria-expanded="false">
              <span class="custom-select__label">통합검색</span>
              <i class="custom-select__caret" aria-hidden="true"></i>
            </button>
            <!-- 실제 전송될 값 -->
            <input type="hidden" name="field" value="all"/>
            <ul class="custom-select__menu" role="listbox">
              <li class="custom-select__option is-active" data-value="all">통합검색</li>
              <li class="custom-select__option" data-value="title">도서명</li>
              <li class="custom-select__option" data-value="author">저자</li>
              <li class="custom-select__option" data-value="publisher">출판사</li>
            </ul>
          </div>

          <input type="search" name="keyword" placeholder="검색어를 입력해주세요." />
          <button type="submit" class="header-search__submit" aria-label="검색">
            <span class="visually-hidden">검색</span>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M10.5 3a7.5 7.5 0 015.9 12.09l4 4a1 1 0 01-1.41 1.41l-4-4A7.5 7.5 0 1110.5 3zm0 2a5.5 5.5 0 100 11 5.5 5.5 0 000-11z"></path>
            </svg>
          </button>
        </form>
      </div>

      <nav class="header-links">
        <a sec:authorize="isAuthenticated()" th:href="@{/cart}">장바구니</a>
        <a sec:authorize="isAuthenticated()" th:href="@{/mypage/orders}">마이페이지</a>
        <a sec:authorize="isAnonymous()" th:href="@{/login}">로그인</a>
        <form sec:authorize="isAuthenticated()"
              th:action="@{/logout}" method="post" class="logout-form">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
          <button type="submit" class="logout-button">로그아웃</button>
        </form>
      </nav>
    </div>

    <div class="header-bottom">
      <nav class="header-category">
        <ul>
          <li><a href="/books">전체</a></li>
          <li><a href="/books?categoryId=1">소설/시/희곡</a></li>
          <li><a href="/books?categoryId=2">에세이</a></li>
          <li><a href="/books?categoryId=3">경제 경영</a></li>
          <li><a href="/books?categoryId=4">인문</a></li>
          <li><a href="/books?categoryId=5">예술</a></li>
          <li><a href="/books?categoryId=6">자연과학</a></li>
          <li><a href="/books?categoryId=7">자기계발</a></li>
          <li><a href="/books?categoryId=8">유아</a></li>
          <li><a href="/books?categoryId=9">IT 모바일</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- 드롭다운 동작 스크립트 -->
  <style>
    .header-links .logout-form { margin:0; display:inline; }
    .header-links .logout-button {
      background:none;
      border:none;
      padding:0;
      font:inherit;
      color:#1f2d3d;
      font-weight:600;
      cursor:pointer;
    }
    .header-links .logout-button:hover {
      color:#0046ff;
    }
  </style>

  <script>
    (function(){
      const root = document.getElementById('fieldSelect');
      const btn  = root.querySelector('.custom-select__trigger');
      const menu = root.querySelector('.custom-select__menu');
      const label= root.querySelector('.custom-select__label');
      const input= root.querySelector('input[name="field"]');

      function open(){  root.classList.add('is-open');  btn.setAttribute('aria-expanded','true'); }
      function close(){ root.classList.remove('is-open');btn.setAttribute('aria-expanded','false'); }

      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        root.classList.contains('is-open') ? close() : open();
      });

      menu.addEventListener('click', (e)=>{
        const opt = e.target.closest('.custom-select__option');
        if(!opt) return;

        // active 표시 갱신
        menu.querySelectorAll('.custom-select__option').forEach(o=>o.classList.remove('is-active'));
        opt.classList.add('is-active');

        // 라벨과 실제 전송 값을 선택 항목으로 갱신
        label.textContent = opt.textContent.trim();
        input.value = opt.dataset.value || 'all';
        close();
      });

      document.addEventListener('click', ()=> close());
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') close(); });
    })();
  </script>
</header>
</body>
</html>
